{"ast":null,"code":"import _slicedToArray from\"D:/rentup/rentup_frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect,useCallback}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";var logoutTimer;var AuthContext=/*#__PURE__*/React.createContext({token:'',isLoggedIn:false,role:'user',changeRole:function changeRole(switchRole){},login:function login(token){},logout:function logout(){}});var calculateRemainingTime=function calculateRemainingTime(expirationTime){var currentTime=new Date().getTime();var adjExpirationTime=new Date(expirationTime).getTime();var remainingDuration=adjExpirationTime-currentTime;return remainingDuration;};var retrieveStoredToken=function retrieveStoredToken(){var storedToken=localStorage.getItem('token');var storedExpirationDate=localStorage.getItem('expirationTime');var remainingTime=calculateRemainingTime(storedExpirationDate);if(remainingTime<=3600){localStorage.removeItem('token');localStorage.removeItem('expirationTime');return null;}return{token:storedToken,duration:remainingTime};};export var AuthContextProvider=function AuthContextProvider(props){var tokenData=retrieveStoredToken();var initialToken;if(tokenData){initialToken=tokenData.token;}var _useState=useState(initialToken),_useState2=_slicedToArray(_useState,2),token=_useState2[0],setToken=_useState2[1];var userIsLoggedIn=!!token;var logoutHandler=useCallback(function(){setToken(null);localStorage.removeItem('token');localStorage.removeItem('expirationTime');if(logoutTimer){clearTimeout(logoutTimer);}},[]);var loginHandler=function loginHandler(token,expirationTime){setToken(token);localStorage.setItem('token',token);localStorage.setItem('expirationTime',expirationTime);var remainingTime=calculateRemainingTime(expirationTime);logoutTimer=setTimeout(logoutHandler,remainingTime);};useEffect(function(){if(tokenData){logoutTimer=setTimeout(logoutHandler,tokenData.duration);}},[tokenData,logoutHandler]);var _useState3=useState('user'),_useState4=_slicedToArray(_useState3,2),role=_useState4[0],setRole=_useState4[1];var changeRoleHandler=function changeRoleHandler(switchRole){if(switchRole===false){setRole('user');}else{setRole('landlord');}};var contextValue={token:token,isLoggedIn:userIsLoggedIn,role:role,changeRole:changeRoleHandler,login:loginHandler,logout:logoutHandler};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:contextValue,children:props.children});};export default AuthContext;","map":{"version":3,"names":["React","useState","useEffect","useCallback","logoutTimer","AuthContext","createContext","token","isLoggedIn","role","changeRole","switchRole","login","logout","calculateRemainingTime","expirationTime","currentTime","Date","getTime","adjExpirationTime","remainingDuration","retrieveStoredToken","storedToken","localStorage","getItem","storedExpirationDate","remainingTime","removeItem","duration","AuthContextProvider","props","tokenData","initialToken","setToken","userIsLoggedIn","logoutHandler","clearTimeout","loginHandler","setItem","setTimeout","setRole","changeRoleHandler","contextValue","children"],"sources":["D:/rentup/rentup_frontend/src/store/auth-context.js"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\r\n\r\nlet logoutTimer;\r\n\r\nconst AuthContext = React.createContext({\r\n    token: '',\r\n    isLoggedIn: false,\r\n    role: 'user',\r\n    changeRole: (switchRole) => {},\r\n    login: (token) => {},\r\n    logout: () => {},\r\n});\r\n\r\nconst calculateRemainingTime = (expirationTime) => {\r\n    const currentTime = new Date().getTime();\r\n    const adjExpirationTime = new Date(expirationTime).getTime();\r\n\r\n    const remainingDuration = adjExpirationTime - currentTime;\r\n\r\n    return remainingDuration;\r\n};\r\n\r\nconst retrieveStoredToken = () => {\r\n    const storedToken = localStorage.getItem('token');\r\n    const storedExpirationDate = localStorage.getItem('expirationTime');\r\n\r\n    const remainingTime = calculateRemainingTime(storedExpirationDate);\r\n\r\n    if (remainingTime <= 3600) {\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('expirationTime');\r\n        return null;\r\n    }\r\n\r\n    return {\r\n        token: storedToken,\r\n        duration: remainingTime,\r\n    };\r\n};\r\n\r\nexport const AuthContextProvider = (props) => {\r\n    const tokenData = retrieveStoredToken();\r\n    \r\n    let initialToken;\r\n    if (tokenData) {\r\n        initialToken = tokenData.token;\r\n    }\r\n\r\n    const [token, setToken] = useState(initialToken);\r\n\r\n    const userIsLoggedIn = !!token;\r\n\r\n    const logoutHandler = useCallback(() => {\r\n        setToken(null);\r\n        localStorage.removeItem('token');\r\n        localStorage.removeItem('expirationTime');\r\n\r\n        if (logoutTimer) {\r\n            clearTimeout(logoutTimer);\r\n        }\r\n    }, []);\r\n\r\n    const loginHandler = (token, expirationTime) => {\r\n        setToken(token);\r\n        localStorage.setItem('token', token);\r\n        localStorage.setItem('expirationTime', expirationTime);\r\n\r\n        const remainingTime = calculateRemainingTime(expirationTime);\r\n\r\n        logoutTimer = setTimeout(logoutHandler, remainingTime);\r\n    };\r\n\r\n    useEffect(() => {\r\n        if (tokenData) {\r\n            logoutTimer = setTimeout(logoutHandler, tokenData.duration);\r\n        }\r\n    }, [tokenData, logoutHandler]);\r\n    \r\n    const [role, setRole] = useState('user')\r\n    \r\n    const changeRoleHandler = (switchRole) => {\r\n        if (switchRole === false) {\r\n            setRole('user')\r\n        }else{\r\n            setRole('landlord')\r\n        }\r\n    }\r\n\r\n    const contextValue = {\r\n        token: token,\r\n        isLoggedIn: userIsLoggedIn,\r\n        role: role,\r\n        changeRole: changeRoleHandler,\r\n        login: loginHandler,\r\n        logout: logoutHandler,\r\n    };\r\n    \r\n\r\n    return (\r\n        <AuthContext.Provider value={contextValue}>\r\n            {props.children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport default AuthContext;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}